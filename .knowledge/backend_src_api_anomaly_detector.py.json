{"is_source_file": true, "format": "Python", "description": "This file defines an 'AnomalyDetector' class for monitoring API endpoint metrics like latency, error rate, and payload size, and detecting anomalies based on fixed thresholds. It includes related data classes such as 'EndpointStats' and 'Anomaly', and references external modules for models and rules.", "external_files": ["./models", "./owasp_rules"], "external_methods": ["OWASP_RULES.get"], "published": ["AnomalyDetector", "EndpointStats", "Anomaly"], "classes": [{"name": "EndpointStats", "description": "Keeps running statistics (count, sum, errors, payload) for an API endpoint to detect anomalies."}, {"name": "Anomaly", "description": "Represents an anomaly event with title, description, severity, and optional rule ID."}, {"name": "AnomalyDetector", "description": "Main class that observes API events and detects anomalies based on simple thresholds for latency, error rate, and payload size."}], "methods": [{"name": "None update(self, ev: EventRecord)", "description": "Updates endpoint statistics with a new EventRecord.", "scope": "EndpointStats", "scopeKind": "class"}, {"name": "Optional[float] mean_latency(self)", "description": "Calculates the average latency.", "scope": "EndpointStats", "scopeKind": "class"}, {"name": "Optional[float] std_latency(self)", "description": "Calculates the standard deviation of latency.", "scope": "EndpointStats", "scopeKind": "class"}, {"name": "float error_rate(self)", "description": "Calculates the error rate.", "scope": "EndpointStats", "scopeKind": "class"}, {"name": "str _key(self, ev: EventRecord)", "description": "Generates a unique key for a given event based on service, method, and path.", "scope": "AnomalyDetector", "scopeKind": "class"}, {"name": "Optional[Anomaly] observe(self, ev: EventRecord)", "description": "Analyzes an event, detects anomalies if thresholds are crossed, and updates baseline statistics.", "scope": "AnomalyDetector", "scopeKind": "class"}, {"name": "None __init__(self)", "scope": "AnomalyDetector", "scopeKind": "class", "description": "unavailable"}], "calls": ["OWASP_RULES.get"], "search-terms": ["AnomalyDetector", "EndpointStats", "anomaly detection", "latency spike", "error rate", "payload jump", "lightweight baselines", "fixed thresholds"], "state": 2, "file_id": 10, "knowledge_revision": 30, "git_revision": "503dc9131a87ccadb497670b73542005fae6c333", "revision_history": [{"24": ""}, {"30": "503dc9131a87ccadb497670b73542005fae6c333"}], "ctags": [{"_type": "tag", "name": "Anomaly", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^class Anomaly:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "AnomalyDetector", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^class AnomalyDetector:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "EndpointStats", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^class EndpointStats:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def __init__(self) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self)", "scope": "AnomalyDetector", "scopeKind": "class"}, {"_type": "tag", "name": "_key", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def _key(self, ev: EventRecord) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, ev: EventRecord)", "scope": "AnomalyDetector", "scopeKind": "class"}, {"_type": "tag", "name": "avg_payload", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    avg_payload: float = 0.0$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "count", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    count: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "error_rate", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def error_rate(self) -> float:$/", "language": "Python", "typeref": "typename:float", "kind": "member", "signature": "(self)", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    errors: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "mean_latency", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def mean_latency(self) -> Optional[float]:$/", "language": "Python", "typeref": "typename:Optional[float]", "kind": "member", "signature": "(self)", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "observe", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def observe(self, ev: EventRecord) -> Optional[Anomaly]:$/", "language": "Python", "typeref": "typename:Optional[Anomaly]", "kind": "member", "signature": "(self, ev: EventRecord)", "scope": "AnomalyDetector", "scopeKind": "class"}, {"_type": "tag", "name": "rule_id", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    rule_id: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "Anomaly", "scopeKind": "class"}, {"_type": "tag", "name": "std_latency", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def std_latency(self) -> Optional[float]:$/", "language": "Python", "typeref": "typename:Optional[float]", "kind": "member", "signature": "(self)", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "sum_latency", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    sum_latency: float = 0.0$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "sum_latency_sq", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    sum_latency_sq: float = 0.0$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "update", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def update(self, ev: EventRecord) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, ev: EventRecord)", "scope": "EndpointStats", "scopeKind": "class"}], "hash": "ca0268aa6ccf234889ecaeaad98ce83f", "format-version": 4, "code-base-name": "backend", "filename": "backend/src/api/anomaly_detector.py", "fields": [{"name": "float avg_payload", "scope": "EndpointStats", "scopeKind": "class", "description": "unavailable"}, {"name": "int count", "scope": "EndpointStats", "scopeKind": "class", "description": "unavailable"}, {"name": "int errors", "scope": "EndpointStats", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] rule_id", "scope": "Anomaly", "scopeKind": "class", "description": "unavailable"}, {"name": "float sum_latency", "scope": "EndpointStats", "scopeKind": "class", "description": "unavailable"}, {"name": "float sum_latency_sq", "scope": "EndpointStats", "scopeKind": "class", "description": "unavailable"}]}