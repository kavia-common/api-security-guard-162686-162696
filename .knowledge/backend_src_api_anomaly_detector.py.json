{"is_source_file": true, "format": "Python", "description": "This is a Python source file implementing an anomaly detection system for API endpoints. It maintains in-memory baselines for metrics like latency, error rate, and payload size, and detects anomalies based on fixed thresholds. It defines data classes for endpoint statistics and anomalies, and includes an AnomalyDetector class with methods for observing events and generating alerts.", "external_files": ["./models", "./owasp_rules"], "external_methods": ["OWASP_RULES.get"], "published": ["Anomaly", "AnomalyDetector"], "classes": [{"name": "EndpointStats", "description": "Maintains runtime statistics for a specific API endpoint, including counts, latency sums, error counts, and payload averages. Provides methods for updating stats and calculating metrics."}, {"name": "Anomaly", "description": "Represents an anomaly detection result, including title, description, severity, and optional rule ID."}, {"name": "AnomalyDetector", "description": "Core class for monitoring API events, detecting anomalies like latency spikes, payload jumps, and error rate increases based on in-memory statistics."}], "methods": [{"name": "None update(self, ev: EventRecord)", "description": "Updates endpoint statistics with data from an EventRecord.", "scope": "EndpointStats", "scopeKind": "class"}, {"name": "Optional[float] mean_latency(self)", "description": "Calculates the mean latency for the recorded events.", "scope": "EndpointStats", "scopeKind": "class"}, {"name": "Optional[float] std_latency(self)", "description": "Calculates the standard deviation of latency.", "scope": "EndpointStats", "scopeKind": "class"}, {"name": "float error_rate(self)", "description": "Calculates the error rate for the endpoint.", "scope": "EndpointStats", "scopeKind": "class"}, {"name": "str _key(self, ev: EventRecord)", "description": "Generates a unique key for an event based on service, method, and path.", "scope": "AnomalyDetector", "scopeKind": "class"}, {"name": "Optional[Anomaly] observe(self, ev: EventRecord)", "description": "Main method to process an event, update statistics, and return a detected anomaly if any.", "scope": "AnomalyDetector", "scopeKind": "class"}, {"name": "None __init__(self)", "scope": "AnomalyDetector", "scopeKind": "class", "description": "unavailable"}], "calls": ["OWASP_RULES.get"], "search-terms": ["AnomalyDetector", "EndpointStats", "lightweight in-memory baselines", "Latency spike detection", "Error rate spike detection", "Payload size jump detection"], "state": 2, "file_id": 10, "knowledge_revision": 24, "git_revision": "", "ctags": [{"_type": "tag", "name": "Anomaly", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^class Anomaly:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "AnomalyDetector", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^class AnomalyDetector:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "EndpointStats", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^class EndpointStats:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def __init__(self) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self)", "scope": "AnomalyDetector", "scopeKind": "class"}, {"_type": "tag", "name": "_key", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def _key(self, ev: EventRecord) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, ev: EventRecord)", "scope": "AnomalyDetector", "scopeKind": "class"}, {"_type": "tag", "name": "avg_payload", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    avg_payload: float = 0.0$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "count", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    count: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "error_rate", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def error_rate(self) -> float:$/", "language": "Python", "typeref": "typename:float", "kind": "member", "signature": "(self)", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "errors", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    errors: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "mean_latency", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def mean_latency(self) -> Optional[float]:$/", "language": "Python", "typeref": "typename:Optional[float]", "kind": "member", "signature": "(self)", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "observe", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def observe(self, ev: EventRecord) -> Optional[Anomaly]:$/", "language": "Python", "typeref": "typename:Optional[Anomaly]", "kind": "member", "signature": "(self, ev: EventRecord)", "scope": "AnomalyDetector", "scopeKind": "class"}, {"_type": "tag", "name": "rule_id", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    rule_id: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "Anomaly", "scopeKind": "class"}, {"_type": "tag", "name": "std_latency", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def std_latency(self) -> Optional[float]:$/", "language": "Python", "typeref": "typename:Optional[float]", "kind": "member", "signature": "(self)", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "sum_latency", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    sum_latency: float = 0.0$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "sum_latency_sq", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    sum_latency_sq: float = 0.0$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "EndpointStats", "scopeKind": "class"}, {"_type": "tag", "name": "update", "path": "/home/kavia/workspace/code-generation/api-security-guard-162686-162696/backend/src/api/anomaly_detector.py", "pattern": "/^    def update(self, ev: EventRecord) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, ev: EventRecord)", "scope": "EndpointStats", "scopeKind": "class"}], "hash": "d0810172d77b193620a6228bd0bb80fd", "format-version": 4, "code-base-name": "backend", "filename": "backend/src/api/anomaly_detector.py", "fields": [{"name": "float avg_payload", "scope": "EndpointStats", "scopeKind": "class", "description": "unavailable"}, {"name": "int count", "scope": "EndpointStats", "scopeKind": "class", "description": "unavailable"}, {"name": "int errors", "scope": "EndpointStats", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] rule_id", "scope": "Anomaly", "scopeKind": "class", "description": "unavailable"}, {"name": "float sum_latency", "scope": "EndpointStats", "scopeKind": "class", "description": "unavailable"}, {"name": "float sum_latency_sq", "scope": "EndpointStats", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"24": ""}]}